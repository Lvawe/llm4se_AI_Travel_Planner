# Supabase é…ç½®æŒ‡å—

æœ¬é¡¹ç›®ä½¿ç”¨ Supabase ä½œä¸ºäº‘ç«¯æ•°æ®åº“ï¼Œå®ç°æ•°æ®çš„äº‘ç«¯åŒæ­¥åŠŸèƒ½ã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹© Supabaseï¼Ÿ

1. **å®Œå…¨æ‰˜ç®¡çš„ PostgreSQL æ•°æ®åº“** - æ— éœ€è‡ªå·±ç»´æŠ¤æ•°æ®åº“æœåŠ¡å™¨
2. **å…è´¹é¢åº¦å……è¶³** - æ¯æœˆ 500MB å­˜å‚¨ã€2GB æ•°æ®ä¼ è¾“
3. **å®æ—¶æ•°æ®åŒæ­¥** - æ”¯æŒå¤šè®¾å¤‡å®æ—¶æ•°æ®åŒæ­¥
4. **å†…ç½®è®¤è¯ç³»ç»Ÿ** - å¯ä»¥é€‰æ‹©ä½¿ç”¨æˆ–ä¸ä½¿ç”¨
5. **è‡ªåŠ¨å¤‡ä»½** - æ•°æ®å®‰å…¨æœ‰ä¿éšœ

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»º Supabase é¡¹ç›®

1. è®¿é—® [Supabase](https://supabase.com/)
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•
3. ç‚¹å‡» "New Project"
4. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **Name**: `ai-travel-planner`
   - **Database Password**: è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆè¯·è®°ä½ï¼ï¼‰
   - **Region**: é€‰æ‹© `Northeast Asia (Tokyo)` æˆ– `Southeast Asia (Singapore)`
   - **Pricing Plan**: é€‰æ‹© `Free`

5. ç­‰å¾…é¡¹ç›®åˆ›å»ºï¼ˆçº¦ 2 åˆ†é’Ÿï¼‰

### 2. è·å–æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

åˆ›å»ºå®Œæˆåï¼š

1. è¿›å…¥é¡¹ç›®è®¾ç½® (Settings)
2. ç‚¹å‡» "Database"
3. æ‰¾åˆ° "Connection string" éƒ¨åˆ†
4. é€‰æ‹© "URI" æ ‡ç­¾
5. å¤åˆ¶è¿æ¥å­—ç¬¦ä¸²ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```
postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT-REF].supabase.co:5432/postgres
```

**æ³¨æ„**: å°† `[YOUR-PASSWORD]` æ›¿æ¢ä¸ºä½ è®¾ç½®çš„æ•°æ®åº“å¯†ç 

### 3. é…ç½®é¡¹ç›®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ›´æ–° `DATABASE_URL`ï¼š

```bash
# Supabase æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://postgres:your-password@db.xxxxx.supabase.co:5432/postgres"
```

### 4. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
cd backend

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
npm install

# ç”Ÿæˆ Prisma Client
npm run db:generate

# è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆåˆ›å»ºè¡¨ç»“æ„ï¼‰
npm run db:migrate
```

### 5. éªŒè¯è¿æ¥

å¯åŠ¨åç«¯æœåŠ¡ï¼š

```bash
npm run dev
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¯´æ˜è¿æ¥æˆåŠŸï¼š

```
ğŸš€ Server is running on port 3001
ğŸ“ API URL: http://localhost:3001
ğŸ¥ Health check: http://localhost:3001/health
```

## Supabase é¡¹ç›®ç®¡ç†

### æŸ¥çœ‹æ•°æ®åº“è¡¨

1. åœ¨ Supabase æ§åˆ¶å°ï¼Œç‚¹å‡»å·¦ä¾§èœå• "Table Editor"
2. å¯ä»¥çœ‹åˆ°ä»¥ä¸‹è¡¨ï¼š
   - `User` - ç”¨æˆ·è¡¨
   - `Trip` - è¡Œç¨‹è¡¨
   - `Expense` - è´¹ç”¨è¡¨
   - `ApiKey` - APIå¯†é’¥è¡¨

### æŸ¥çœ‹æ•°æ®

ä½¿ç”¨ Table Editor å¯ä»¥ç›´æ¥æŸ¥çœ‹å’Œç¼–è¾‘æ•°æ®ï¼ˆä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼‰

### SQL ç¼–è¾‘å™¨

ç‚¹å‡»å·¦ä¾§ "SQL Editor" å¯ä»¥ç›´æ¥æ‰§è¡Œ SQL æŸ¥è¯¢

### å®æ—¶æ•°æ®åº“ç›‘æ§

ç‚¹å‡» "Database" â†’ "Roles" å¯ä»¥æŸ¥çœ‹æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢ç»Ÿè®¡

## ä½¿ç”¨ Prisma Studio ç®¡ç†æ•°æ®

Prisma Studio æä¾›äº†æ›´å‹å¥½çš„æ•°æ®åº“ç®¡ç†ç•Œé¢ï¼š

```bash
cd backend
npm run db:studio
```

æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ `http://localhost:5555`ï¼Œåœ¨è¿™é‡Œå¯ä»¥ï¼š
- æŸ¥çœ‹æ‰€æœ‰è¡¨å’Œæ•°æ®
- æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤è®°å½•
- æŸ¥çœ‹å…³ç³»æ•°æ®

## ç”Ÿäº§ç¯å¢ƒé…ç½®

### Docker Compose é…ç½®

ç¼–è¾‘ `docker-compose.yml`ï¼š

```yaml
services:
  backend:
    environment:
      DATABASE_URL: ${DATABASE_URL}  # ä»ç¯å¢ƒå˜é‡è¯»å–
      # å…¶ä»–é…ç½®...
```

### ç¯å¢ƒå˜é‡ç®¡ç†

ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š

1. **ä¸è¦æäº¤ `.env` åˆ° Git**ï¼ˆå·²åœ¨ `.gitignore` ä¸­ï¼‰
2. **ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡**
3. **å®šæœŸæ›´æ¢æ•°æ®åº“å¯†ç **

## æ•°æ®è¿ç§»

### ä»æœ¬åœ° PostgreSQL è¿ç§»åˆ° Supabase

å¦‚æœä½ ä¹‹å‰ä½¿ç”¨æœ¬åœ°æ•°æ®åº“å¹¶æœ‰æ•°æ®ï¼š

```bash
# 1. å¯¼å‡ºæœ¬åœ°æ•°æ®
pg_dump -h localhost -U travelplanner -d travel_planner > backup.sql

# 2. å¯¼å…¥åˆ° Supabaseï¼ˆåœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ backup.sqlï¼‰
```

### åˆ›å»ºæ–°è¿ç§»

å½“æ•°æ®åº“æ¨¡å‹å˜æ›´æ—¶ï¼š

```bash
cd backend

# ä¿®æ”¹ prisma/schema.prisma

# åˆ›å»ºè¿ç§»
npx prisma migrate dev --name migration_name

# åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒ
npx prisma migrate deploy
```

## Supabase é«˜çº§åŠŸèƒ½

### 1. Row Level Security (RLS)

Supabase æ”¯æŒè¡Œçº§å®‰å…¨ç­–ç•¥ï¼Œå¯ä»¥ç¡®ä¿ï¼š
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- é˜²æ­¢æ•°æ®æ³„éœ²

é…ç½®ç¤ºä¾‹ï¼ˆåœ¨ SQL Editor ä¸­æ‰§è¡Œï¼‰ï¼š

```sql
-- å¯ç”¨ RLS
ALTER TABLE "Trip" ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºç­–ç•¥ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è¡Œç¨‹
CREATE POLICY "Users can only view their own trips"
ON "Trip"
FOR SELECT
USING (auth.uid()::text = "userId");
```

### 2. å®æ—¶è®¢é˜…

Supabase æ”¯æŒå®æ—¶æ•°æ®è®¢é˜…ï¼Œå¯ä»¥å®ç°ï¼š
- å¤šè®¾å¤‡å®æ—¶åŒæ­¥
- åä½œç¼–è¾‘
- å®æ—¶é€šçŸ¥

### 3. å­˜å‚¨æœåŠ¡

å¯ä»¥ä½¿ç”¨ Supabase Storage å­˜å‚¨ï¼š
- ç”¨æˆ·å¤´åƒ
- è¡Œç¨‹å›¾ç‰‡
- æ–‡æ¡£æ–‡ä»¶

### 4. è¾¹ç¼˜å‡½æ•°

å¯ä»¥éƒ¨ç½² Serverless å‡½æ•°å¤„ç†å¤æ‚é€»è¾‘

## å¸¸è§é—®é¢˜

### Q: è¿æ¥è¶…æ—¶
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- ç¡®è®¤ç½‘ç»œè¿æ¥
- éªŒè¯æ•°æ®åº“å¯†ç æ­£ç¡®

### Q: è¿ç§»å¤±è´¥
- æ£€æŸ¥è¿æ¥å­—ç¬¦ä¸²
- ç¡®è®¤ Prisma ç‰ˆæœ¬å…¼å®¹
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### Q: å…è´¹é¢åº¦ç”¨å®Œäº†æ€ä¹ˆåŠï¼Ÿ
- å…è´¹ç‰ˆæ¯æœˆ 500MB å­˜å‚¨ã€2GB ä¼ è¾“
- å¯¹äºå¼€å‘å’Œå°å‹é¡¹ç›®å®Œå…¨å¤Ÿç”¨
- å¦‚éœ€æ›´å¤šèµ„æºï¼Œå¯å‡çº§åˆ° Pro ç‰ˆï¼ˆ$25/æœˆï¼‰

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ
- Supabase è‡ªåŠ¨æ¯å¤©å¤‡ä»½
- ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¯¼å‡ºï¼šSettings â†’ Database â†’ Database Backups

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ ç´¢å¼•** - å¯¹é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•
2. **ä½¿ç”¨è¿æ¥æ± ** - Prisma è‡ªåŠ¨ç®¡ç†è¿æ¥æ± 
3. **ç¼“å­˜ç­–ç•¥** - å¯¹ä¸å¸¸å˜åŒ–çš„æ•°æ®ä½¿ç”¨ç¼“å­˜
4. **æ‰¹é‡æ“ä½œ** - ä½¿ç”¨ Prisma çš„æ‰¹é‡æ“ä½œ API

## ç›‘æ§å’Œåˆ†æ

åœ¨ Supabase æ§åˆ¶å°ï¼š

1. **Database Health** - æŸ¥çœ‹æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡
2. **API Logs** - æŸ¥çœ‹ API è°ƒç”¨æ—¥å¿—
3. **Database Usage** - æŸ¥çœ‹å­˜å‚¨å’Œå¸¦å®½ä½¿ç”¨æƒ…å†µ

## æ”¯æŒèµ„æº

- [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
- [Prisma + Supabase æŒ‡å—](https://www.prisma.io/docs/guides/database/supabase)
- [Supabase Discord ç¤¾åŒº](https://discord.supabase.com/)

## ä¸‹ä¸€æ­¥

å®Œæˆ Supabase é…ç½®åï¼š

1. âœ… æµ‹è¯•ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
2. âœ… åˆ›å»ºç¤ºä¾‹è¡Œç¨‹æ•°æ®
3. âœ… æµ‹è¯•å¤šè®¾å¤‡åŒæ­¥ï¼ˆåœ¨ä¸åŒæµè§ˆå™¨æˆ–è®¾å¤‡ç™»å½•åŒä¸€è´¦å·ï¼‰
4. âœ… å¼€å‘è¡Œç¨‹ç®¡ç†ç•Œé¢

---

**é…ç½®å®Œæˆåï¼Œè¯·åœ¨ README.md ä¸­æ·»åŠ ä½ çš„ Supabase é¡¹ç›®ä¿¡æ¯ï¼ˆä¸è¦æ³„éœ²å¯†ç ï¼‰**
