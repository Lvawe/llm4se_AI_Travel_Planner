# 🧪 快速测试指南

## 修复的问题

1. ✅ **AI 行程计划现在会显示在行程详情页**
2. ✅ **地图会正确定位到目的地**

---

## 📋 测试步骤

### 测试 1: 验证 AI 计划显示

1. **访问应用**
   ```
   http://localhost:5090
   ```

2. **登录或注册账号**

3. **创建新行程**
   - 点击 "创建新行程"
   - 填写信息：
     - 目的地：成都
     - 日期：选择未来日期
     - 预算：5000
     - 人数：2人
     - 偏好：美食、历史文化

4. **使用 AI 生成**
   - 在描述框输入："想体验正宗川菜，参观大熊猫基地"
   - 或点击麦克风图标使用语音输入
   - 点击 **"✨ AI 智能生成行程"** 按钮
   - 等待 3-5 秒

5. **查看生成的计划**
   - 应该看到：
     - 📅 行程安排（每日活动）
     - 💰 预算明细（交通、住宿等）
     - 💡 旅行建议

6. **创建行程**
   - 点击 "创建行程"
   - 自动跳转到行程详情页

7. **验证详情页显示**
   - 应该看到行程信息卡片
   - **重点**：下方应该有 **"✨ AI 生成的行程计划"** 卡片
   - 卡片有紫色渐变背景
   - 显示完整的行程、预算、建议

### 测试 2: 验证地图定位

在行程详情页：

1. **查看右侧地图**
   - 地图应该加载完成
   - 不应该卡顿或闪烁

2. **检查定位**
   - 地图中心应该在目的地城市（如成都）
   - 应该有一个红色标记点
   - 标记点应该有下落动画

3. **点击标记**
   - 点击地图上的标记点
   - 应该弹出信息窗口
   - 显示目的地名称

4. **创建不同城市的行程**
   - 测试其他城市：北京、上海、杭州
   - 每次地图都应该正确定位

---

## ✅ 预期结果

### AI 计划显示效果

```
┌────────────────────────────────────────┐
│ ✨ AI 生成的行程计划                    │
│ ─────────────────────────────────────  │
│                                        │
│ 📅 行程安排                            │
│ ┌────────────────────────────────────┐ │
│ │ 第1天：抵达成都                     │ │
│ │ • 到达双流机场                      │ │
│ │ • 入住酒店                          │ │
│ │ • 宽窄巷子品尝小吃                  │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 💰 预算明细                            │
│ ┌────────────────────────────────────┐ │
│ │ 交通：         ¥800                │ │
│ │ 住宿：         ¥1200               │ │
│ │ 餐饮：         ¥800                │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 💡 旅行建议                            │
│ ┌────────────────────────────────────┐ │
│ │ 💡 提前预订熊猫基地门票             │ │
│ │ 💡 尝试正宗川菜和火锅               │ │
│ └────────────────────────────────────┘ │
└────────────────────────────────────────┘
```

### 地图显示效果

- 地图平滑加载
- 自动定位到目的地
- 有标记点和动画
- 点击显示信息窗口
- 无卡顿或重复渲染

---

## 🐛 如果遇到问题

### 问题 1: AI 计划不显示

**可能原因**：
- AI API 调用失败
- 数据未正确保存

**检查方法**：
1. 打开浏览器开发者工具（F12）
2. 查看 Console 是否有错误
3. 查看 Network 标签：
   - 检查 `/api/ai/generate-plan` 请求
   - 检查返回的数据格式
   - 检查 `/api/trips` 创建请求

**解决方法**：
- 确认 `DASHSCOPE_API_KEY` 配置正确
- 查看后端终端日志
- 如果 API 失败，会使用默认模板

### 问题 2: 地图不显示或报错

**可能原因**：
- 高德地图 API Key 未配置
- 网络问题

**检查方法**：
1. 查看 Console 错误信息
2. 检查 `frontend/.env.local` 文件
3. 确认 `NEXT_PUBLIC_AMAP_KEY` 存在

**解决方法**：
```bash
# frontend/.env.local
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_AMAP_KEY=your_amap_key_here
```

### 问题 3: 地图不定位

**可能原因**：
- 目的地名称无法识别
- 地址解析失败

**检查方法**：
- 查看 Console 是否有 "地址解析失败" 错误
- 尝试更常见的城市名称

**解决方法**：
- 使用明确的城市名称（如"北京"而不是"北京市海淀区某街道"）
- 检查网络连接

---

## 📸 截图对比

### 修复前
- ❌ 行程详情页只有基本信息
- ❌ 看不到 AI 生成的计划
- ❌ 地图可能不动或卡顿

### 修复后
- ✅ 显示完整的 AI 计划
- ✅ 美观的渐变卡片样式
- ✅ 地图流畅定位

---

## 🎯 核心功能验证

### 必须通过的测试

- [ ] 能创建行程
- [ ] AI 能生成计划
- [ ] 计划能在创建页显示
- [ ] 计划能在详情页显示
- [ ] 地图能正确定位
- [ ] 点击标记显示信息

### 建议测试的场景

- [ ] 不同城市（北京、上海、广州、深圳、成都）
- [ ] 不同日期范围（3天、7天、14天）
- [ ] 不同预算（1000、5000、10000）
- [ ] 不同偏好组合
- [ ] 有/无语音输入
- [ ] 有/无描述内容

---

## 💡 测试技巧

1. **使用开发者工具**
   - F12 打开控制台
   - 查看 Network 请求
   - 查看 Console 日志

2. **检查数据流**
   ```
   创建页输入 → AI生成 → 显示计划 → 保存 → 详情页显示
   ```

3. **边界情况**
   - 没有 AI 计划的行程（应该不显示那个卡片）
   - 空的行程描述
   - 无效的目的地名称

4. **性能检查**
   - 地图不应该卡顿
   - 页面加载应该流畅
   - AI 生成应该在 5 秒内完成

---

## 📞 反馈问题

如果测试发现问题，请提供：

1. **问题描述**: 具体什么不工作
2. **复现步骤**: 如何触发问题
3. **截图**: 浏览器界面和 Console
4. **环境信息**: 浏览器版本、操作系统
5. **日志**: 后端终端的错误信息

---

## ✅ 测试完成确认

完成所有测试后，确认：

- [ ] AI 计划在详情页正确显示
- [ ] 地图能定位到目的地
- [ ] 没有控制台错误
- [ ] 用户体验流畅
- [ ] 所有功能正常工作

**测试通过后即可正常使用！** 🎉

---

**测试指南创建时间**: 2025-11-05  
**适用版本**: v1.0.0
